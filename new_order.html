<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New/Edit Order</title>
    <link rel="stylesheet" href="css/new_order.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />

</head>

<body>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, collection, addDoc, doc, updateDoc, deleteDoc, onSnapshot, getDocs, query, where, getDoc, orderBy, limit, startAfter, endBefore, getCountFromServer } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"; // सभी ज़रूरी फंक्शन

        const firebaseConfig = { /* ... आपका कॉन्फ़िगरेशन ... */
          apiKey: "AIzaSyBQj5rQmE77kKKGYixP8y3Hcimz8tiAqzQ",
          authDomain: "madhav-multyprint.firebaseapp.com",
          projectId: "madhav-multyprint",
          storageBucket: "madhav-multyprint.firebasestorage.app",
          messagingSenderId: "104988349637",
          appId: "1:104988349637:web:faf045b77c6786a4e70cac"
         };

        try {
            let app;
            if (!window.firebaseAppInitialized) {
                 app = initializeApp(firebaseConfig);
                 window.firebaseAppInitialized = true;
                 console.log("Firebase initialized on new_order page.");
            } else { console.log("Firebase already initialized."); }
            const db = window.db || getFirestore(app || undefined);

            // Make functions globally available
            window.db = db; window.collection = collection; window.addDoc = addDoc;
            window.doc = doc; window.updateDoc = updateDoc; window.deleteDoc = deleteDoc;
            window.onSnapshot = onSnapshot; window.getDocs = getDocs; window.query = query;
            window.where = where; window.getDoc = getDoc; window.orderBy = orderBy;
            window.limit = limit; window.startAfter = startAfter; window.endBefore = endBefore;
            window.getCountFromServer = getCountFromServer;
            console.log("Firebase functions available globally.");

        } catch (e) { console.error("Firebase initialization error:", e); if (!window.db) { alert("Database connection error!"); } }
    </script>

    <div class="container">
        <div class="header" id="formHeader"> New Order
        </div>

        <form id="newOrderForm">
            <input type="hidden" id="editOrderId" name="editOrderId">

            <div class="section-title">1. Customer Details</div>
            <div class="form-group">
                <label for="full_name">Full Name:</label>
                <input type="text" id="full_name" name="full_name" placeholder="Enter Full Name" autocomplete="off" required>
            </div>
            <div class="form-group">
                <label for="address">Address:</label>
                <input type="text" id="address" name="address" placeholder="Enter Address">
            </div>
            <div class="form-group">
                <label for="whatsapp_no">WhatsApp No:</label>
                <input type="text" id="whatsapp_no" name="whatsapp_no" placeholder="Enter WhatsApp No" required>
            </div>
            <div class="form-group">
                <label for="contact_no">Contact No:</label>
                <input type="text" id="contact_no" name="contact_no" placeholder="Enter Contact No">
            </div>

            <div class="section-title">2. Order Details</div>
            <div class="form-group">
                <label for="display_order_id">Order ID:</label> <input type="text" id="display_order_id" name="display_order_id" placeholder="Auto-generated" readonly> </div>
            <div class="form-group">
                <label for="order_date">Order Date:</label>
                <input type="date" id="order_date" name="order_date" required>
            </div>
            <div class="form-group">
                <label for="delivery_date">Delivery Date:</label>
                <input type="date" id="delivery_date" name="delivery_date">
            </div>

            <div class="section-title">3. Order Status</div>
            <div class="form-group order-status-group">
                <label><input type="checkbox" name="order_status" value="Order Received">Order Received</label>
                <label><input type="checkbox" name="order_status" value="Designing">Designing</label>
                <label><input type="checkbox" name="order_status" value="Verification">Verification</label>
                <label><input type="checkbox" name="order_status" value="Design Approved">Design Approved</label>
                <label><input type="checkbox" name="order_status" value="Ready for Working">Ready for Working</label>
                <label><input type="checkbox" name="order_status" value="Printing">Printing</label>
                <label><input type="checkbox" name="order_status" value="Delivered">Delivered</label>
                <label><input type="checkbox" name="order_status" value="Completed">Completed</label>
            </div>

            <div class="section-title">4. Product & Job Detail</div>
            <div id="product-details-container">
                <div class="product-detail-group">
                    <label for="product_name_1">Product Name:</label>
                    <input type="text" id="product_name_1" name="product_name[]" placeholder="Enter Product Name" autocomplete="off">
                    <label for="quantity_1">Qty</label>
                    <input type="number" id="quantity_1" name="quantity[]" placeholder="Enter Quantity">
                    <button type="button" class="add-product-button" onclick="addProductRow()">Add</button>
                </div>
            </div>

            <div class="section-title">5. Reminder & Priority</div>
            <div class="form-group">
                <label>Urgent?</label>
                <label><input type="radio" name="urgent" value="Yes">Yes</label>
                <label><input type="radio" name="urgent" value="No" checked>No</label>
            </div>

            <div class="section-title">6. Remarks</div>
            <div class="remarks-group">
                <label for="remarks">Remarks:</label>
                <textarea id="remarks" name="remarks"></textarea>
            </div>

            <div class="button-container">
                <button type="button" class="send-button" disabled title="Functionality not implemented">Send</button>
                <button type="submit" class="save-button" id="saveOrderBtn">Save Order</button>
                 <button type="button" onclick="window.location.href='order_history.html'" style="background-color:#6c757d; margin-left: 10px;">Cancel</button>
            </div>
        </form> </div>

    <script src="js/new_order.js" type="module"></script>

</body>
</html>