<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New Order</title>
    <link rel="stylesheet" href="css/new_order.css">
</head>

<body>
    <div class="container">
        <div class="header">
            New Order
        </div>

        <div class="section-title">1. Customer Details</div>
        <div class="form-group">
            <label for="full_name">Full Name:</label>
            <input type="text" id="full_name" name="full_name" placeholder="Enter Full Name" autocomplete="off">
        </div>
        <div class="form-group">
            <label for="address">Address:</label>
            <input type="text" id="address" name="address" placeholder="Enter Address">
        </div>
        <div class="form-group">
            <label for="whatsapp_no">WhatsApp No:</label>
            <input type="text" id="whatsapp_no" name="whatsapp_no" placeholder="Enter WhatsApp No">
        </div>
        <div class="form-group">
            <label for="contact_no">Contact No:</label>
            <input type="text" id="contact_no" name="contact_no" placeholder="Enter Contact No">
        </div>

        <div class="section-title">2. Order Details</div>
        <div class="form-group">
            <label for="order_id">Order ID:</label>
            <input type="text" id="order_id" name="order_id" placeholder="Auto-generated" readonly>
        </div>
        <div class="form-group">
            <label for="order_date">Order Date:</label>
            <input type="date" id="order_date" name="order_date">
        </div>
        <div class="form-group">
            <label for="delivery_date">Delivery Date:</label>
            <input type="date" id="delivery_date" name="delivery_date">
        </div>

        <div class="section-title">3. Order Status</div>
        <div class="form-group order-status-group">
            <label><input type="checkbox" name="order_status" value="Order Received">Order Received</label>
            <label><input type="checkbox" name="order_status" value="Designing">Designing</label>
            <label><input type="checkbox" name="order_status" value="Verification">Verification</label>
            <label><input type="checkbox" name="order_status" value="Design Approved">Design Approved</label>
            <label><input type="checkbox" name="order_status" value="Ready for Working">Ready for Working</label>
            <label><input type="checkbox" name="order_status" value="Printing">Printing</label>
            <label><input type="checkbox" name="order_status" value="Delivered">Delivered</label>
            <label><input type="checkbox" name="order_status" value="Completed">Completed</label>
        </div>

        <div class="section-title">3. Product & Job Detail</div>
        <div id="product-details-container">
            <div class="product-detail-group">
                <label for="product_name_1">Product Name:</label>
                <input type="text" id="product_name_1" name="product_name[]" placeholder="Enter Product Name"
                    autocomplete="off">
                <label for="quantity_1">Qty</label>
                <input type="number" id="quantity_1" name="quantity[]" placeholder="Enter Quantity">
                <button type="button" class="add-product-button" onclick="addProductRow()">Add</button>
            </div>
        </div>

        <div class="section-title">4. Reminder & Priority</div>
        <div class="form-group">
            <label>Urgent?</label>
            <label><input type="radio" name="urgent" value="Yes">Yes</label>
            <label><input type="radio" name="urgent" value="No" checked>No</label>
        </div>

        <div class="section-title">5. Remarks</div>
        <div class="remarks-group">
            <label for="remarks">Remarks:</label>
            <textarea id="remarks" name="remarks"></textarea>
        </div>

        <div class="button-container">
            <button type="button" class="send-button">Send</button>
            <button type="button" class="save-button">Save Order</button>
        </div>
    </div>

    <script>
        let productRowCount = 1;

        function addProductRow() {
            productRowCount++;
            const container = document.getElementById('product-details-container');
            const newRow = document.createElement('div');
            newRow.classList.add('product-detail-group');
            newRow.innerHTML = `
                <label for="product_name_${productRowCount}">Product Name:</label>
                <input type="text" id="product_name_${productRowCount}" name="product_name[]" placeholder="Enter Product Name" autocomplete="off" style="height: 30px;">
                <label for="quantity_${productRowCount}">Qty</label>
                <input type="number" id="quantity_${productRowCount}" name="quantity[]" placeholder="Enter Quantity" style="height: 30px;">
                <button type="button" class="add-product-button" onclick="addProductRow()">Add</button>
            `;
            container.appendChild(newRow);
        }

        const orderStatusCheckboxes = document.querySelectorAll('input[name="order_status"]');
        let currentStatusIndex = -1;

        orderStatusCheckboxes.forEach((checkbox, index) => {
            checkbox.addEventListener('change', function () {
                if (this.checked) {
                    if (currentStatusIndex !== -1 && index < currentStatusIndex) {
                        this.checked = false;
                        return;
                    }

                    orderStatusCheckboxes.forEach(otherCheckbox => {
                        if (otherCheckbox !== this) {
                            otherCheckbox.checked = false;
                        }
                    });
                    currentStatusIndex = index;
                } else if (!this.checked) {
                    if (currentStatusIndex === index) {
                        currentStatusIndex = -1;
                    }
                }
            });
        });

        function saveOrderData() {
            const fullName = document.getElementById('full_name').value;
            const address = document.getElementById('address').value;
            const whatsappNo = document.getElementById('whatsapp_no').value;
            const contactNo = document.getElementById('contact_no').value;
            const orderDate = document.getElementById('order_date').value;
            const deliveryDate = document.getElementById('delivery_date').value;
            const urgent = document.querySelector('input[name="urgent"]:checked')?.value || 'No';
            const remarks = document.getElementById('remarks').value;
            const productNames = Array.from(document.querySelectorAll('input[name="product_name[]"]')).map(input => input.value);
            const quantities = Array.from(document.querySelectorAll('input[name="quantity[]"]')).map(input => input.value);
            const orderStatus = Array.from(document.querySelectorAll('input[name="order_status"]:checked')).map(checkbox => checkbox.value);

            const orderData = {
                orderId: Date.now(),
                fullName: fullName,
                address: address,
                whatsappNo: whatsappNo,
                contactNo: contactNo,
                orderDate: orderDate,
                deliveryDate: deliveryDate,
                urgent: urgent,
                remarks: remarks,
                products: productNames.map((name, index) => ({ name: name, quantity: quantities[index] })),
                status: orderStatus
            };

            let orders = localStorage.getItem('orders');
            orders = orders ? JSON.parse(orders) : [];
            orders.push(orderData);
            localStorage.setItem('orders', JSON.stringify(orders));

            alert('Order saved!');
            window.location.href = 'order_history.html';
        }

        document.addEventListener('DOMContentLoaded', function() {
            const saveButton = document.querySelector('.save-button');
            if (saveButton) {
                saveButton.addEventListener('click', saveOrderData);
            }
        });
    </script>
</body>

</html>