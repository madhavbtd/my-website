<!DOCTYPE html>
<html lang="hi"> <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>नया/संपादित ऑर्डर</title> <link rel="stylesheet" href="css/new_order.css"> <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, collection, addDoc, doc, updateDoc, deleteDoc, onSnapshot, getDocs, query, where, getDoc, orderBy } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        const firebaseConfig = {
          apiKey: "AIzaSyBQj5rQmE77kKKGYixP8y3Hcimz8tiAqzQ", // आपका कॉन्फ़िगरेशन
          authDomain: "madhav-multyprint.firebaseapp.com",
          projectId: "madhav-multyprint",
          storageBucket: "madhav-multyprint.appspot.com", // सही स्टोरेज बकेट नाम जांच लें
          messagingSenderId: "104988349637",
          appId: "1:104988349637:web:faf045b77c6786a4e70cac"
        };
        try {
            let app;
            if (!window.firebaseAppInitialized) {
                 app = initializeApp(firebaseConfig);
                 window.firebaseAppInitialized = true; console.log("Firebase initialized on new_order page.");
            } else { console.log("Firebase already initialized."); }
            const db = window.db || getFirestore(app || undefined);
            // ग्लोबल फंक्शन्स (पहले जैसा)
            window.db = db; window.collection = collection; window.addDoc = addDoc; window.doc = doc;
            window.updateDoc = updateDoc; window.deleteDoc = deleteDoc; window.onSnapshot = onSnapshot;
            window.getDocs = getDocs; window.query = query; window.where = where; window.getDoc = getDoc;
            window.orderBy = orderBy;
            console.log("Firebase functions available globally.");
        } catch (e) {
            console.error("Firebase initialization error:", e);
            if (!window.db) { alert("डेटाबेस कनेक्शन में त्रुटि!"); } // हिंदी एरर
        }
    </script>

    <div class="container">
        <div class="header" id="formHeader">नया ऑर्डर</div> <form id="newOrderForm">
            <input type="hidden" id="editOrderId" name="editOrderId">
             <input type="hidden" id="selectedCustomerId" name="selectedCustomerId">

            <div class="section-title">1. ग्राहक का विवरण</div>
            <div class="form-group">
                <label for="full_name">पूरा नाम:</label> <input type="text" id="full_name" name="full_name" required autocomplete="off" placeholder="ग्राहक का नाम टाइप करें..."> <div id="customer-suggestions-name" class="suggestions-box"></div> </div>
            <div class="form-group">
                <label for="address">पता:</label> <input type="text" id="address" name="address" readonly placeholder="ग्राहक चुनने पर स्वतः भरेगा"> </div>
            <div class="form-group">
                <label for="whatsapp_no">व्हाट्सएप नंबर:</label> <input type="text" id="whatsapp_no" name="whatsapp_no" required autocomplete="off" placeholder="व्हाट्सएप नंबर टाइप करें..."> <div id="customer-suggestions-whatsapp" class="suggestions-box"></div> </div>
            <div class="form-group">
                <label for="contact_no">संपर्क नंबर:</label> <input type="text" id="contact_no" name="contact_no" readonly placeholder="ग्राहक चुनने पर स्वतः भरेगा"> </div>
             <p class="info-text">*नया ग्राहक यहाँ से नहीं जोड़ा जा सकता, केवल मौजूदा ग्राहक चुनें।</p> <div class="section-title">2. ऑर्डर का विवरण</div>
            <div class="form-group">
                <label for="manual_order_id">ऑर्डर ID (मैन्युअल):</label> <input type="text" id="manual_order_id" name="manual_order_id" placeholder="वैकल्पिक - खाली छोड़ने पर ऑटो-जनरेट होगा"> </div>
             <div class="form-group">
                <label for="display_order_id">ऑर्डर ID (सिस्टम):</label> <input type="text" id="display_order_id" name="display_order_id" readonly placeholder="ऑटो-जनरेटेड या मौजूदा"> </div>
            <div class="form-group">
                <label for="order_date">ऑर्डर की तारीख:</label> <input type="date" id="order_date" name="order_date" required>
            </div>
            <div class="form-group">
                <label for="delivery_date">डिलीवरी की तारीख:</label> <input type="date" id="delivery_date" name="delivery_date">
            </div>

            <div class="section-title">3. ऑर्डर स्टेटस</div>
            <div id="order-status-group" class="form-group order-status-group">
                <label><input type="checkbox" name="order_status" value="Order Received"><span>Order Received</span></label>
                <label><input type="checkbox" name="order_status" value="Designing"><span>Designing</span></label>
                <label><input type="checkbox" name="order_status" value="Verification"><span>Verification</span></label>
                <label><input type="checkbox" name="order_status" value="Design Approved"><span>Design Approved</span></label>
                <label><input type="checkbox" name="order_status" value="Ready for Working"><span>Ready for Working</span></label>
                <label><input type="checkbox" name="order_status" value="Printing"><span>Printing</span></label>
                <label><input type="checkbox" name="order_status" value="Delivered"><span>Delivered</span></label>
                <label><input type="checkbox" name="order_status" value="Completed"><span>Completed</span></label>
            </div>

            <div class="section-title">4. उत्पाद और जॉब विवरण</div>
            <div class="product-input-area">
                <div class="product-entry-group">
                    <div class="form-group product-name-group">
                        <label for="product_name_input">उत्पाद का नाम:</label> <input type="text" id="product_name_input" name="product_name_input" placeholder="उत्पाद का नाम टाइप करें..." autocomplete="off"> <div id="product-suggestions" class="suggestions-box"></div> </div>
                     <div class="form-group product-qty-group">
                        <label for="quantity_input">मात्रा (Qty):</label> <input type="number" id="quantity_input" name="quantity_input" placeholder="मात्रा"> </div>
                    <button type="button" id="add-product-btn" class="add-product-button">
                        <i class="fas fa-plus"></i> उत्पाद जोड़ें </button>
                </div>
                 <p class="info-text">*नया उत्पाद यहाँ से नहीं जोड़ा जा सकता, केवल मौजूदा उत्पाद चुनें।</p> </div>
            <div id="product-list" class="product-list-container">
                </div>

            <div class="section-title">5. रिमाइंडर और प्राथमिकता</div>
            <div class="form-group">
                <label>अत्यावश्यक (Urgent)?</label> <div class="radio-group">
                     <label><input type="radio" name="urgent" value="Yes"> हाँ</label> <label><input type="radio" name="urgent" value="No" checked> नहीं</label> </div>
            </div>

            <div class="section-title">6. रिमार्क्स</div>
            <div class="remarks-group">
                <label for="remarks">रिमार्क्स:</label> <textarea id="remarks" name="remarks" placeholder="कोई विशेष नोट..."></textarea> </div>

            <div class="button-container">
                <button type="submit" class="save-button" id="saveOrderBtn">
                    <i class="fas fa-save"></i> <span>ऑर्डर सेव करें</span> </button>
                <button type="button" onclick="window.location.href='order_history.html'" class="cancel-button">
                    रद्द करें </button>
            </div>
        </form>
    </div>

    <div id="whatsapp-reminder-popup" class="popup-overlay">
        <div class="popup-content">
            <button id="popup-close-btn" class="popup-close" title="बंद करें">&times;</button> <h4>ऑर्डर सफलतापूर्वक सेव हुआ!</h4> <p>ग्राहक को अपडेट भेजें?</p> <div id="whatsapp-message-preview" class="message-preview">
                </div>
            <a href="#" id="whatsapp-send-link" class="button whatsapp-send-btn" target="_blank">
                <i class="fab fa-whatsapp"></i> व्हाट्सएप पर भेजें </a>
        </div>
    </div>

    <script src="js/new_order.js" type="module" defer></script> </body>
</html>