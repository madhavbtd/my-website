<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DEBUG - Supplier Auth Check</title>
    <style> body { font-family: sans-serif; padding: 20px; } </style>

    <script type="module">
        // Firebase Services Import
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

        // !!!!! अपनी वास्तविक Firebase कॉन्फ़िगरेशन यहाँ डालें !!!!!
        const firebaseConfig = {
          apiKey: "YOUR_API_KEY",
          authDomain: "YOUR_AUTH_DOMAIN",
          projectId: "YOUR_PROJECT_ID",
          storageBucket: "YOUR_STORAGE_BUCKET",
          messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
          appId: "YOUR_APP_ID"
        };

        // Firebase App Initialization
        let app;
        let auth;
        try {
             if (!window.firebaseAppInitialized) {
                 app = initializeApp(firebaseConfig);
                 window.firebaseAppInitialized = true;
                 window.firebaseApp = app;
                 console.log("DEBUG PAGE: Firebase initialized.");
             } else {
                 app = window.firebaseApp;
                 console.log("DEBUG PAGE: Firebase already initialized.");
             }
             auth = getAuth(app);

             // ----- Promise-Based Authentication State Check -----
             const statusDiv = document.getElementById('auth-status');
             statusDiv.textContent = "Checking Authentication..."; // Initial message

             function checkAuthState() {
                 console.log("DEBUG PAGE: checkAuthState: Promise created.");
                 return new Promise((resolve, reject) => {
                     const timer = setTimeout(() => { reject(new Error("Auth check timed out.")); }, 10000);
                     const unsubscribe = onAuthStateChanged(auth, (user) => {
                         clearTimeout(timer);
                         unsubscribe();
                         console.log("DEBUG PAGE: checkAuthState: onAuthStateChanged fired. User:", user ? user.uid : null);
                         resolve(user);
                     }, (error) => { clearTimeout(timer); reject(error); });
                 });
             }

             checkAuthState().then(user => {
                 if (user) {
                     // ----- USER IS LOGGED IN -----
                     console.log(`DEBUG PAGE: User confirmed LOGGED IN. UID: ${user.uid}.`);
                     statusDiv.textContent = `Authentication Success! User ID: ${user.uid}. You should NOT be redirected.`;
                     statusDiv.style.color = 'green';
                     // *** यहाँ हम जानबूझकर initializeSuppliersPage() को कॉल नहीं कर रहे हैं ***
                 } else {
                     // ----- USER IS NOT LOGGED IN -----
                     console.log("DEBUG PAGE: User confirmed NOT logged in. Redirecting to login...");
                     statusDiv.textContent = "Authentication Failed. Redirecting to login...";
                     statusDiv.style.color = 'red';
                     // Redirect logic
                     const currentPage = window.location.pathname.split('/').pop() || 'index.html';
                     if (currentPage.toLowerCase() !== 'login.html') {
                        const originalUrl = encodeURIComponent(window.location.pathname + window.location.search);
                        // !!!!! login.html का सही पाथ यहाँ डालें !!!!!
                        window.location.replace(`login.html?redirectUrl=${originalUrl}`);
                     }
                 }
             }).catch(error => {
                  console.error("DEBUG PAGE: Failed to check auth state:", error);
                  alert("DEBUG PAGE: Error checking auth state: " + error.message);
                  statusDiv.textContent = `Authentication Check Error: ${error.message}`;
                  statusDiv.style.color = 'red';
             });
             // ----- End of Promise-Based Auth Check -----

        } catch(e) {
            console.error("DEBUG PAGE: CRITICAL Firebase setup error:", e);
            alert("DEBUG PAGE: Critical setup error. Check console.");
            document.body.innerHTML = `<p style="color:red;">Critical setup error: ${e.message}</p>`;
        }
    </script>
    </head>
<body>
    <h1>Supplier Page - Authentication Debug</h1>
    <div id="auth-status" style="margin-top: 20px; font-weight: bold;">
        Initializing...
    </div>
    <p>If you see a success message above, the authentication check on this specific page is working. The problem might be with the full page content or suppliers.js.</p>
    <p>If you are redirected to login, the authentication check itself is failing on this page load.</p>

</body>
</html>