<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Management</title>
    <link rel="stylesheet" href="css/product_management.css"> <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
    <div class="container">
        <div class="header">
            <i class="fas fa-box-open header-icon"></i>
            <h1>Product Management</h1>
        </div>

        <div class="filter-bar">
             <div class="filter-group">
                 <button id="addNewProductBtn" class="button add-new-button">
                    <i class="fas fa-plus"></i> Add New Product
                </button>
            </div>
             <div class="filter-group">
                <label for="filterSearch"><i class="fas fa-search"></i> Search:</label>
                <input type="text" id="filterSearch" placeholder="Product Name...">
            </div>
             <div class="filter-group filter-sort">
                <label for="sort-products"><i class="fas fa-sort"></i> Sort by:</label>
                <select id="sort-products">
                    <option value="createdAt_desc">Newest First</option>
                    <option value="createdAt_asc">Oldest First</option>
                    <option value="printName_asc">Name (A-Z)</option>
                    <option value="printName_desc">Name (Z-A)</option>
                    <option value="price_asc">Price (Low-High)</option>
                    <option value="price_desc">Price (High-Low)</option>
                 </select>
            </div>
            <div class="filter-group">
                 <button id="clearFiltersBtn" class="button clear-filters-button" title="Clear search and reset sort">
                    <i class="fas fa-times"></i> Clear
                 </button>
            </div>
        </div>

        <div class="table-container">
            <table id="productTable">
                <thead>
                    <tr>
                        <th>Product Name</th>
                        <th>Price</th> <th>Category</th> <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="productTableBody">
                    <tr>
                        <td colspan="4" id="loadingMessage">Loading products...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div id="productModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" id="closeProductModal" title="Close">&times;</span>
            <h2 id="modalTitle">Add New Product</h2>
            <form id="productForm">
                <input type="hidden" id="editProductId"> <div class="form-group">
                    <label for="productPrintName">Product Name (Print Name) <span class="required">*</span>:</label>
                    <input type="text" id="productPrintName" required placeholder="Name shown in order form">
                </div>
                <div class="form-group">
                    <label for="productPrice">Price:</label>
                    <input type="number" id="productPrice" placeholder="e.g., 150.00" step="0.01" min="0">
                </div>
                <div class="form-group">
                    <label for="productCategory">Category:</label>
                    <input type="text" id="productCategory" placeholder="e.g., Visiting Card, Banner">
                </div>
                 <div class="modal-actions">
                    <button type="submit" id="saveProductBtn" class="button save-button">
                        <i class="fas fa-save"></i> <span>Save Product</span>
                    </button>
                     <button type="button" id="cancelProductBtn" class="button cancel-button">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>


    <script type="module">
        // Import necessary Firebase functions
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, collection, doc, addDoc, updateDoc, deleteDoc, onSnapshot, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        // --- PASTE YOUR firebaseConfig HERE ---
        const firebaseConfig = {
          apiKey: "AIzaSyBQj5rQmE77kKKGYixP8y3Hcimz8tiAqzQ", // YOUR CONFIG
          authDomain: "madhav-multyprint.firebaseapp.com", // YOUR CONFIG
          projectId: "madhav-multyprint", // YOUR CONFIG
          storageBucket: "madhav-multyprint.appspot.com", // YOUR CONFIG
          messagingSenderId: "104988349637", // YOUR CONFIG
          appId: "1:104988349637:web:faf045b77c6786a4e70cac" // YOUR CONFIG
        };
        // --- END OF PASTE ---

        // Initialize Firebase and make functions globally available
         try {
            let app;
            if (!window.firebaseAppInitialized) {
                 app = initializeApp(firebaseConfig);
                 window.firebaseAppInitialized = true;
                 console.log("Firebase initialized on product_management page.");
            } else {
                 console.log("Firebase already initialized (product_management).");
            }
            const db = window.db || getFirestore(app || undefined);
            window.db = db;

            // Make Firestore functions globally available
            window.collection = collection;
            window.doc = doc;
            window.addDoc = addDoc;
            window.updateDoc = updateDoc;
            window.deleteDoc = deleteDoc;
            window.onSnapshot = onSnapshot;
            window.query = query;
            window.orderBy = orderBy;
            window.serverTimestamp = serverTimestamp;

            console.log("Firebase functions available globally for product_management.");

        } catch (e) {
            console.error("Firebase initialization error (product_management):", e);
            if (!window.db) {
                alert("Database connection error on product page!");
                 const loadingCell = document.getElementById('loadingMessage');
                 if(loadingCell) loadingCell.textContent = 'Database connection error!';
            }
        }
    </script>

    <script src="js/product_management.js" type="module" defer></script>

</body>
</html>