<script type="module">
        // --- Firebase Setup ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import {
            getFirestore, collection, doc, addDoc, getDocs, updateDoc, deleteDoc, onSnapshot,
            query, orderBy, where, Timestamp
         } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

         // **** Your Firebase Configuration (Copied from your other working files) ****
         const firebaseConfig = {
           apiKey: "AIzaSyBQj5rQmE77kKKGYixP8y3Hcimz8tiAqzQ", // From your other files
           authDomain: "madhav-multyprint.firebaseapp.com",   // From your other files
           projectId: "madhav-multyprint",                // From your other files
           storageBucket: "madhav-multyprint.appspot.com",   // From your other files
           messagingSenderId: "104988349637",             // From your other files
           appId: "1:104988349637:web:faf045b77c6786a4e70cac" // From your other files
         };
         // !!!!! MAKE SURE THESE VALUES ARE CORRECT !!!!!

        let app;
        let auth;
        let db;

        try {
             console.log("supplier_management.html: Attempting Firebase initialization...");
             if (!window.firebaseAppInitialized) {
                 app = initializeApp(firebaseConfig);
                 window.firebaseAppInitialized = true;
                 window.firebaseApp = app; // Store globally
                 console.log("Firebase initialized on supplier_management.html");
             } else {
                 app = window.firebaseApp; // Use existing instance
                 console.log("Firebase already initialized (supplier_management.html)");
             }
             auth = getAuth(app);
             db = getFirestore(app);
             console.log("supplier_management.html: Auth and Firestore instances obtained.");

             // Make Firestore functions globally available for supplier_management.js
             window.db = db;
             window.collection = collection;
             window.doc = doc;
             window.addDoc = addDoc;
             window.getDocs = getDocs;
             window.updateDoc = updateDoc;
             window.deleteDoc = deleteDoc;
             window.onSnapshot = onSnapshot;
             window.query = query;
             window.orderBy = orderBy;
             window.where = where;
             window.Timestamp = Timestamp;
             console.log("supplier_management.html: Firestore functions made global.");

             // --- Authentication Check ---
             console.log("supplier_management.html: Setting up onAuthStateChanged listener...");
             onAuthStateChanged(auth, (user) => {
                console.log("supplier_management.html: onAuthStateChanged triggered.");
                 if (!user) {
                     console.log("User not logged in on supplier_management. Redirecting to login.html...");
                     // Prevent redirect loop if somehow already on login page
                     if (window.location.pathname.split('/').pop().toLowerCase() !== 'login.html') {
                          window.location.replace('login.html');
                     }
                 } else {
                     console.log("supplier_management.html: User is logged in:", user.uid);
                     // Initialize page-specific JS functions AFTER auth is confirmed
                     if(window.initializeSupplierManagement) {
                        console.log("supplier_management.html: Calling initializeSupplierManagement().");
                        window.initializeSupplierManagement();
                     } else {
                        console.warn("supplier_management.html: initializeSupplierManagement function not found on window.");
                     }
                 }
             });
             console.log("supplier_management.html: onAuthStateChanged listener attached.");

        } catch(e) {
            console.error("supplier_management.html: Firebase setup error:", e);
            alert("Error loading application.");
            // Optionally redirect to login on critical error
            // if (window.location.pathname.split('/').pop().toLowerCase() !== 'login.html') {
            //    window.location.replace('login.html');
            // }
        }
        console.log("supplier_management.html: Module script finished execution.");
        // --- End Firebase Setup ---
    </script>