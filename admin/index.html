<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Madhav Multiprint Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/index.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js" defer></script>
</head>

<body>
    <div class="container">
        <div class="sidebar">
             <h2><img src="https://i.ibb.co/Z6gKD9Rd/1.png" alt="Madhav Multiprint Logo"></h2>
             <ul>
                <li><a href="index.html" class="active"><i class="fas fa-tachometer-alt"></i> <span>Dashboard</span></a></li>
                <li><a href="order_history.html"><i class="fas fa-history"></i> <span>Order History</span></a></li>
                <li><a href="customer_management.html"><i class="fas fa-users"></i> <span>Customers</span></a></li>
                <li><a href="supplier_management.html"><i class="fas fa-truck"></i> <span>Suppliers</span></a></li>
                <li><a href="expenses.html"><i class="fas fa-wallet"></i> <span>Expenses</span></a></li>
                <li><a href="lic_management.html"><i class="fas fa-shield-alt"></i> <span>LIC Management</span></a></li>
                <li><a href="#"><i class="fas fa-chart-bar"></i> <span>Report</span></a></li>
                <li><a href="#"><i class="fas fa-code-branch"></i> <span>Branch Manage</span></a></li>
                <li><a href="#"><i class="fas fa-cog"></i> <span>Settings</span></a></li>
                <li><a href="product_management.html"><i class="fas fa-box-open"></i> <span>Product</span></a></li>
                <li><a href="manage-online-products.html"><i class="fas fa-store"></i> <span>Online Products</span></a></li>
                <li><a href="view-online-orders.html"><i class="fas fa-receipt"></i> <span>Online Orders</span></a></li>

                <li class="menu-section-header"><span>Agent Portal</span></li>
                <li><a href="agent_management.html"><i class="fas fa-users-cog"></i> <span>Agent Management</span></a></li>
                <li><a href="pending_agent_orders.html"><i class="fas fa-hourglass-half"></i> <span>Pending Agent Orders</span></a></li>
                <li><a href="agent_commission_report.html"><i class="fas fa-file-invoice-dollar"></i> <span>Agent Commission</span></a></li>
                
                <li><a href="#"><i class="fas fa-tools"></i> <span>Tools</span></a></li>
                <li><a href="#" id="logout-link"><i class="fas fa-sign-out-alt"></i> <span>LOGOUT</span></a></li>
             </ul>
        </div>

        <div class="main-content" id="main-content">
            <div class="header updated-header">
                <span class="welcome-text" id="welcome-user">Welcome...</span>
                <div class="header-actions">
                    <div class="header-buttons">
                        <a href="customer_management.html?action=add" class="button-base add-customer-btn"><i class="fas fa-user-plus"></i> Add Customer</a>
                        <a href="supplier_management.html#add" class="button-base add-supplier-btn"><i class="fas fa-truck"></i> Add Supplier</a>
                        <a href="new_order.html" class="button-base new-order-btn"><i class="fas fa-plus-circle"></i> New Order</a>
                        <button type="button" id="quickAddPaymentBtn" class="button-base quick-payment-btn"><i class="fas fa-dollar-sign"></i> Quick Payment</button>
                    </div>
                    <div class="date-time-container" id="currentDateTime">
                        <span class="loading-placeholder">Loading date...</span>
                    </div>
                     <div class="header-icons">
                         <button class="icon-button" id="notificationsBtn" title="Notifications"><i class="fas fa-bell"></i><span class="badge" id="notificationCount">0</span></button>
                         <button class="icon-button" id="settingsBtn" title="Settings"><i class="fas fa-cog"></i></button>
                     </div>
                </div>
            </div>

            <div class="kpi-section card-layout">
                 <div class="kpi-card"> <i class="fas fa-users kpi-icon"></i> <div class="kpi-value" id="kpi-total-customers"><span class="loading-placeholder">...</span></div> <div class="kpi-label">Total Customers</div> </div>
                 <div class="kpi-card"> <i class="fas fa-truck kpi-icon"></i> <div class="kpi-value" id="kpi-total-suppliers"><span class="loading-placeholder">...</span></div> <div class="kpi-label">Total Suppliers</div> </div>
                 <div class="kpi-card"> <i class="fas fa-wallet kpi-icon"></i> <div class="kpi-value" id="kpi-pending-payments"><span class="loading-placeholder">...</span></div> <div class="kpi-label">Pending Payments</div> </div>
                 <div class="kpi-card"> <i class="fas fa-calendar-day kpi-icon"></i> <div class="kpi-value" id="kpi-orders-today"><span class="loading-placeholder">...</span></div> <div class="kpi-label">Orders Today</div> </div>
                 <div class="kpi-card">
                     <i class="fas fa-file-invoice kpi-icon"></i>
                     <span class="kpi-value" id="kpi-pending-pos">...</span>
                     <div class="kpi-label">PENDING POs</div>
                 </div>
                 <div class="kpi-card">
                     <i class="fas fa-cloud-download-alt kpi-icon"></i> <div class="kpi-value" id="kpi-online-pending-orders"><span class="loading-placeholder">...</span></div>
                     <div class="kpi-label">Online Pending Orders</div>
                 </div>
            </div>

            <div class="order-control-panel">
                <div class="panel-item light-blue"> <i class="fas fa-shopping-bag panel-icon"></i> Order Received <span class="panel-count" id="count-order-received"><span class="loading-placeholder">..</span></span> <a href="order_history.html?status=Order+Received" class="button-link">View</a> </div>
                <div class="panel-item light-orange"> <i class="fas fa-hourglass-half panel-icon"></i> Designing <span class="panel-count" id="count-designing"><span class="loading-placeholder">..</span></span> <a href="order_history.html?status=Designing" class="button-link">View</a> </div>
                <div class="panel-item light-green"> <i class="fas fa-check-circle panel-icon"></i> Verification <span class="panel-count" id="count-verification"><span class="loading-placeholder">..</span></span> <a href="order_history.html?status=Verification" class="button-link">View</a> </div>
                <div class="panel-item light-red"> <i class="fas fa-thumbs-up panel-icon"></i> Design Approved <span class="panel-count" id="count-design-approved"><span class="loading-placeholder">..</span></span> <a href="order_history.html?status=Design+Approved" class="button-link">View</a> </div>
                <div class="panel-item light-blue"> <i class="fas fa-print panel-icon"></i> Printing <span class="panel-count" id="count-printing"><span class="loading-placeholder">..</span></span> <a href="order_history.html?status=Printing" class="button-link">View</a> </div>
                <div class="panel-item light-orange"> <i class="fas fa-cog panel-icon"></i> Ready For Working <span class="panel-count" id="count-ready-for-working"><span class="loading-placeholder">..</span></span> <a href="order_history.html?status=Ready+for+Working" class="button-link">View</a> </div>
                <div class="panel-item light-green"> <i class="fas fa-truck panel-icon"></i> Delivered <span class="panel-count" id="count-delivered"><span class="loading-placeholder">..</span></span> <a href="order_history.html?status=Delivered" class="button-link">View</a> </div>
                <div class="panel-item light-red"> <i class="fas fa-check-double panel-icon"></i> Completed <span class="panel-count" id="count-completed"><span class="loading-placeholder">..</span></span> <a href="order_history.html?status=Completed" class="button-link">View</a> </div>
            </div>

            <div class="search-bar order-search-bar">
                <label for="order-id-search">Search Order ID / Customer / LIC:</label>
                <input type="text" id="order-id-search" placeholder="Search...">
                <button id="order-id-search-button"><i class="fas fa-search"></i></button>
                <div id="order-suggestions" class="suggestions-list"></div>
            </div>

            <div class="dashboard-grid">
                 <div class="info-feed-section card-layout">
                     <h3><i class="fas fa-history"></i> Recent Activity</h3>
                     <ul id="recent-activity-list">
                         <li class="loading-placeholder">Loading recent activity...</li>
                     </ul>
                 </div>
                 <div class="reminder-section card-layout">
                     <h3><i class="fas fa-bell"></i> Reminders & Tasks</h3>
                     <h4>Upcoming LIC Premiums (15 Days)</h4>
                     <ul id="lic-reminder-list">
                          <li class="loading-placeholder">Loading LIC reminders...</li>
                     </ul>
                     <h4>Upcoming Tasks (7 Days)</h4>
                      <ul id="upcoming-task-list">
                          <li class="loading-placeholder">Loading tasks...</li>
                      </ul>
                      <h4>Upcoming Deliveries (3 Days)</h4>
                      <ul id="upcoming-delivery-list">
                           <li class="loading-placeholder">Loading deliveries...</li>
                      </ul>
                 </div>
                 <div class="chart-section card-layout">
                       <h3><i class="fas fa-chart-pie"></i> Order Status Overview</h3>
                       <div class="chart-container">
                            <canvas id="orderStatusChart"></canvas>
                       </div>
                   </div>
            </div>

            <div id="quickPaymentSearchModal" class="modal">
                <div class="modal-content small-modal">
                    <span class="close-btn" id="closeQuickSearchModal" title="Close">&times;</span>
                    <h2><i class="fas fa-search info-icon"></i> Quick Payment - Find Customer</h2>
                    <div class="form-group">
                        <label for="quick-payment-search-input">Enter Customer Name or Mobile No.:</label>
                        <input type="text" id="quick-payment-search-input" placeholder="Name or Mobile No. ...">
                    </div>
                    <div id="quick-payment-search-results" class="suggestions-list" style="position: static; display: block; max-height: 200px; border: 1px solid #ccc; margin-top: 10px;">
                        <div class="suggestion-item no-suggestions">Type to search...</div>
                    </div>
                    <div class="modal-actions" style="margin-top: 20px; border-top: none; justify-content: center;">
                         <button type="button" id="cancelQuickSearchBtn" class="button cancel-button">Cancel</button>
                     </div>
                </div>
            </div>
            <div id="addPaymentModal" class="modal">
                <div class="modal-content small-modal">
                    <span class="close-btn" id="closePaymentModal" title="Close">&times;</span>
                    <h2><i class="fas fa-money-bill-wave success-icon"></i> Add New Payment for <span id="payment-modal-cust-name">Customer</span></h2>
                    <p class="customer-balance-display" style="text-align: center; margin-bottom: 15px; font-size: 1.1em;">
                        Current Balance: <strong id="payment-modal-cust-balance">Loading...</strong>
                    </p>
                    <form id="addPaymentForm">
                         <input type="hidden" id="quickPaymentCustomerId">
                        <div class="form-group">
                            <label for="paymentAmount">Amount Paid <span class="required">*</span>:</label>
                            <input type="number" id="paymentAmount" step="0.01" required placeholder="e.g., 500.00">
                        </div>
                        <div class="form-group">
                             <label for="paymentDate">Payment Date <span class="required">*</span>:</label>
                            <input type="date" id="paymentDate" required>
                        </div>
                        <div class="form-group">
                             <label for="paymentMethod">Payment Method:</label>
                            <select id="paymentMethod">
                                <option value="Cash">Cash</option>
                                <option value="Online">Online</option>
                                <option value="Cheque">Cheque</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                             <label for="paymentNotes">Notes:</label>
                             <textarea id="paymentNotes" rows="2" placeholder="Optional payment notes"></textarea>
                        </div>
                        <div class="modal-actions">
                             <button type="submit" id="savePaymentBtn" class="button save-button"><i class="fas fa-save"></i> Save Payment</button>
                            <button type="button" id="cancelPaymentBtn" class="button cancel-button">Cancel</button>
                        </div>
                    </form>
                </div>
            </div>
        </div> </div> <script src="js/utils.js" type="module" defer></script>
    <script type="module" src="js/firebase-init.js"></script>
    <script type="module" src="js/dashboard.js"></script>
    <script>
        function setActiveLink() {
             try {
                const path = window.location.pathname;
                // Handle root path and index.html as the same for dashboard active state
                const page = path.substring(path.lastIndexOf('/') + 1) || 'index.html';
                const links = document.querySelectorAll('.sidebar ul li a');

                links.forEach(l => {
                    const hrefAttr = l.getAttribute('href');
                    l.classList.remove('active'); // Remove active from all links first
                    if (hrefAttr) {
                        // Extract filename from href, handle potential parameters/hashes
                        const linkPage = hrefAttr.substring(hrefAttr.lastIndexOf('/') + 1).split('?')[0].split('#')[0] || 'index.html';
                        // Check if the current page matches the link's page
                        if (page === linkPage) {
                            l.classList.add('active');
                        }
                        // Special case for dashboard (index.html or root path)
                        else if ((page === 'index.html' || path === '/' || page === '') && linkPage === 'index.html') {
                             l.classList.add('active');
                        }
                    }
                });
             } catch(e) {
                console.error("Error setting active link:", e);
             }
        }
        // Run on initial load and after navigation events
        window.addEventListener('DOMContentLoaded', setActiveLink);
        window.addEventListener('popstate', setActiveLink); // Handle browser back/forward navigation
    </script>
</body>
</html>
