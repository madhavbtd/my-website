<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online Product Management</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/customer_management.css">
    <link rel="stylesheet" href="css/order_history.css">
    <link rel="stylesheet" href="css/manage-online-products.css"> <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <script type="module">
        // Firebase Core and Services - Initialized here and core services exposed globally
        import { initializeApp, getApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        // Auth functions are imported and used directly in the main script
        // import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import {
            getFirestore, collection, doc, addDoc, updateDoc, deleteDoc,
            onSnapshot, query, orderBy, serverTimestamp, Timestamp, getDoc, writeBatch // Added writeBatch import
        } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        import {
            getStorage, ref, uploadBytesResumable, getDownloadURL, deleteObject
        } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBQj5rQmE77kKKGYixP8y3Hcimz8tiAqzQ", // सुनिश्चित करें कि यह सही API Key है
            authDomain: "madhav-multyprint.firebaseapp.com",
            projectId: "madhav-multyprint",
            storageBucket: "madhav-multyprint.firebasestorage.app",
            messagingSenderId: "104988349637",
            appId: "1:104988349637:web:faf045b77c6786a4e70cac"
        };

        let app;
        try {
            // Check if Firebase app is already initialized
            let isInitialized = false;
            try {
                app = getApp(); // Try to get an existing app
                isInitialized = true;
                console.log("Firebase app already exists.");
            } catch (e) {
                // App does not exist, proceed to initialize
                isInitialized = false;
            }

            if (!isInitialized) {
                app = initializeApp(firebaseConfig);
                console.log("Firebase app initialized.");
            }

            // Expose core services globally for the main script
            window.firebaseApp = app; // Expose app instance
            window.db = getFirestore(app); // Get and expose db
            window.storage = getStorage(app); // Get and expose storage

            // Expose Firestore/Storage functions directly
            window.collection = collection;
            window.doc = doc;
            window.addDoc = addDoc;
            window.updateDoc = updateDoc;
            window.deleteDoc = deleteDoc;
            window.onSnapshot = onSnapshot;
            window.query = query;
            window.orderBy = orderBy;
            window.serverTimestamp = serverTimestamp;
            window.Timestamp = Timestamp;
            window.getDoc = getDoc;
            window.writeBatch = writeBatch; // Expose writeBatch

            window.storageRef = ref;
            window.uploadBytesResumable = uploadBytesResumable;
            window.getDownloadURL = getDownloadURL;
            window.deleteObject = deleteObject;

            console.log("Core Firebase services and functions made globally available.");

            // Authentication state listener and page initialization logic is handled in manage-online-products.js

        } catch(e) {
            console.error("Firebase setup error in HTML:", e);
            alert("App Initialization Error. Check console.");
            // Optionally display an error message on the page if Firebase fails to initialize
            const loadingRow = document.getElementById('loadingMessage'); // Try to find the loading row
            if (loadingRow && loadingRow.parentElement) {
                 const colspan = loadingRow.parentElement.children.length;
                 loadingRow.parentElement.innerHTML = `<tr><td colspan="${colspan}" style="color: red; text-align: center;">Error: Failed to initialize Firebase. Check console.</td></tr>`;
            } else {
                 document.body.innerHTML = "<div style='color: red; text-align: center; margin-top: 50px;'>Error: Failed to initialize application. Check console.</div>";
            }
        }
    </script>
    <script src="js/manage-online-products.js" type="module" defer></script>

</head>
<body>
    <div class="container">
        <div class="header">
            <i class="fas fa-store header-icon"></i> <h1>Online Product Management</h1>
        </div>

        <div class="breadcrumb-container">
          <a href="index.html">Home</a> / <span>Online Product Management</span>
        </div>

        <div class="filter-bar">
            <div class="filter-group">
                <button id="addNewProductBtn" class="button add-new-button">
                    <i class="fas fa-plus"></i> Add New Online Product
                </button>
            </div>
             <div class="filter-group">
                <label for="filterSearch"><i class="fas fa-search"></i> Search:</label>
                <input type="text" id="filterSearch" placeholder="Name, Category...">
             </div>
             <div class="filter-group filter-sort">
                <label for="sort-products"><i class="fas fa-sort"></i> Sort by:</label>
                <select id="sort-products">
                     <option value="createdAt_desc">Newest First</option>
                    <option value="createdAt_asc">Oldest First</option>
                    <option value="productName_asc">Name (A-Z)</option>
                    <option value="productName_desc">Name (Z-A)</option>
                     <option value="pricing.rate_asc">Rate (Low-High)</option>
                     <option value="pricing.rate_desc">Rate (High-Low)</option>
                </select>
            </div>
            <div class="filter-group">
                 <button id="clearFiltersBtn" class="button clear-filters-button" title="Clear search and reset sort">
                     <i class="fas fa-times"></i> Clear
                 </button>
            </div>
        </div>

        <div id="bulkActionsContainer" style="margin-bottom: 20px; padding: 15px; border: 1px solid #eee; border-radius: 8px; background-color: #f9f9f9; display: none; align-items: center; gap: 15px;">
             <span id="selectedCount" style="font-weight: bold; color: var(--text-color-dark);">0 selected</span>
            <button id="bulkEditButton" class="button secondary-button" style="display: none;"><i class="fas fa-edit"></i> Bulk Edit</button>
        </div>


        <div class="table-container">
            <table id="productTable">
                <thead>
                     <tr>
                        <th style="width: 4%; text-align: center;">Select</th>
                        <th style="width: 17%;">Name</th>
                        <th style="width: 11%;">Category</th>
                        <th style="width: 10%;">Brand</th>
                        <th style="text-align: right; width: 8%;">Rate</th>
                        <th style="text-align: center; width: 7%;">Unit</th>
                        <th style="text-align: center; width: 7%;">Enabled</th>
                        <th style="text-align: center; width: 9%;">Date Added</th>
                        <th style="text-align: right; width: 9%;">Current Stock</th>
                        <th style="text-align: center; width: 18%;">Actions</th>
                    </tr>
                 </thead>
                <tbody id="productTableBody">
                    <tr>
                        <td colspan="10" id="loadingMessage">Loading online products...</td>
                    </tr>
                 </tbody>
            </table>
        </div>
    </div>

    <div id="productModal" class="modal">
        <div class="modal-content large-modal">
            <span class="close-btn" id="closeProductModal" title="Close">&times;</span>
            <h2 id="modalTitle"><i class="fas fa-box-open info-icon"></i> Add New Online Product</h2>

            <form id="productForm">
                <input type="hidden" id="editProductId">
                <input type="hidden" id="existingImageUrls" value="[]">
                <input type="hidden" id="existingDiagramUrl">

                <div class="product-form-grid">

                    <div class="form-column"> <fieldset>
                            <legend><i class="fas fa-info-circle"></i> Basic Details</legend>
                            <div class="form-group">
                               <label for="productName">Product Name <span class="required">*</span>:</label>
                               <input type="text" id="productName" required placeholder="Name shown on website">
                           </div>
                            <div class="form-group">
                               <label for="productCategory">Category/Group <span class="required">*</span>:</label>
                               <input type="text" id="productCategory" required placeholder="e.g., Wedding Card, Flex Banner">
                           </div>
                            <div class="form-group">
                               <label for="productUnit">Unit <span class="required">*</span>:</label>
                               <select id="productUnit" required>
                                   <option value="">-- Select Unit --</option>
                                   <option value="Qty">Qty</option>
                                   <option value="Sq Feet">Sq Feet</option>
                                   <option value="Nos">Nos</option>
                               </select>
                           </div>
                            <div class="form-group">
                               <label for="productDescription">Description:</label>
                               <textarea id="productDescription" rows="4" placeholder="Product details shown to customer"></textarea>
                           </div>
                            <div class="form-group">
                               <label for="isEnabled">
                                  <input type="checkbox" id="isEnabled" checked> Show on Website (Enabled)
                              </label>
                          </div>
                        </fieldset>

                        <div id="image-upload-section">
                               <h3><i class="fas fa-images"></i> Product Images</h3>
                               <div class="form-group">
                                   <label for="productImages">Select Images (Max 4):</label>
                                   <input type="file" id="productImages" multiple accept="image/png, image/jpeg, image/webp">
                                   <small>Select new images to add or replace existing ones.</small>
                               </div>
                               <label>Image Previews (Click <span style="color:red; font-weight:bold;">&times;</span> to remove):</label>
                               <div id="image-preview-area"></div>
                               <div id="upload-progress-info" style="font-size: 0.9em; margin-top: 10px; min-height: 1.2em;"></div>
                        </div>

                        <fieldset>
                           <legend><i class="fas fa-drafting-compass"></i> Product Diagram</legend>
                           <div class="form-group">
                               <label for="productDiagram">Upload Diagram (Optional):</label>
                               <input type="file" id="productDiagram" accept=".pdf,.png,.jpg,.jpeg,.webp">
                               <small>PDF or Image file. Agents can download this.</small>
                               <div id="diagram-link-area" style="margin-top: 10px; display: none;">
                                   <label style="font-weight:normal; font-size:0.9em;">Current Diagram:</label>
                                   <a href="#" id="viewDiagramLink" target="_blank" rel="noopener noreferrer" style="font-size:0.9em; word-break: break-all;">View/Download</a>
                                   <button type="button" id="removeDiagramBtn" class="button small-button danger-button" style="margin-left: 10px; padding: 3px 6px; font-size: 0.8em;" title="Remove Diagram"><i class="fas fa-times"></i> Remove</button>
                               </div>
                               <div id="diagram-upload-progress" style="font-size: 0.9em; margin-top: 5px; min-height: 1.2em;"></div>
                           </div>
                       </fieldset>

                    </div> <div class="form-column"> <fieldset>
                            <legend><i class="fas fa-dollar-sign"></i> Price Details</legend>

                            <div class="form-group price-group">
                                <label for="productPurchasePrice">Purchase Price:</label>
                                <input type="number" id="productPurchasePrice" placeholder="0.00" step="0.01" min="0">
                            </div>
                             <div class="form-group">
                                <label for="productGstRate">GST Rate (%):</label>
                                <input type="number" id="productGstRate" placeholder="e.g., 18" step="0.01" min="0" max="100">
                            </div>
                            <hr style="margin: 20px 0;">

                            <div id="priceTabsContainer" class="price-tabs">
                                <button type="button" class="price-tab-btn active" data-rate-type="online">Online</button>
                                <button type="button" class="price-tab-btn" data-rate-type="retail">Retail</button>
                                <button type="button" class="price-tab-btn" data-rate-type="agent">Agent</button>
                                <button type="button" class="price-tab-btn" data-rate-type="reseller">Wholesale</button>
                            </div>

                            <div class="form-group price-group">
                                <label for="currentRateInput" id="currentRateLabel">Online Customer Rate*:</label>
                                <input type="number" id="currentRateInput" required placeholder="0.00" step="0.01" min="0">
                                <small>Rate for the selected type above.</small>
                            </div>

                             <div id="applyRateCheckboxesContainer" class="apply-rate-checkboxes">
                                 </div>

                            <hr style="margin: 20px 0;">

                            <div class="form-group sq-feet-only price-group" style="display: none;">
                                <label for="productMinOrderValue">Min. Order Value (Sq Ft Only):</label>
                                <input type="number" id="productMinOrderValue" placeholder="e.g., 300" step="0.01" min="0">
                            </div>

                            <div class="form-group price-group">
                                <label for="productMrp">M.R.P.:</label>
                                <input type="number" id="productMrp" placeholder="0.00" step="0.01" min="0">
                            </div>

                        </fieldset>

                        <fieldset id="wedding-card-fields" style="display: none;">
                            <legend>Wedding Card Charges</legend>
                             <div class="form-group price-group"><label for="designCharge">Design Charge:</label><input type="number" id="designCharge" placeholder="0.00" step="0.01" min="0"></div>
                             <div class="form-group price-group"><label for="printingCharge">Printing Charge (Base):</label><input type="number" id="printingCharge" placeholder="e.g., 700 per 100" step="0.01" min="0"></div>
                             <div class="form-group price-group"><label for="transportCharge">Transport Charge:</label><input type="number" id="transportCharge" placeholder="0.00" step="0.01" min="0"></div>
                             <div class="form-group"><label for="extraMarginPercent">Extra Margin (%):</label><input type="number" id="extraMarginPercent" placeholder="e.g., 10" step="0.01" min="0"></div>
                        </fieldset>

                        </div> <div class="form-column"> <fieldset>
                             <legend><i class="fas fa-clipboard-list"></i> Internal Details (Optional)</legend>
                             <div class="form-group"><label for="productBrand">Brand:</label><input type="text" id="productBrand"></div>
                             <div class="form-group"><label for="productItemCode">Item Code:</label><input type="text" id="productItemCode"></div>
                             <div class="form-group"><label for="productHsnSacCode">HSN / SAC Code:</label><input type="text" id="productHsnSacCode"></div>
                         </fieldset>

                        <fieldset>
                            <legend><i class="fas fa-cubes"></i> Stock Management</legend>
                            <div class="form-group">
                                <label for="productCurrentStock">Current Stock:</label>
                                <input type="number" id="productCurrentStock" placeholder="0" min="0">
                                <small>Enter the current available quantity of this product.</small>
                            </div>
                            <div class="form-group">
                                <label for="productMinStockLevel">Minimum Stock Level (Optional):</label>
                                <input type="number" id="productMinStockLevel" placeholder="e.g., 10" min="0">
                                <small>Optional. Set a threshold for low stock alerts (feature to be implemented).</small>
                            </div>
                        </fieldset>

                         <fieldset>
                           <legend><i class="fas fa-cogs"></i> Other Options</legend>
                            <div class="form-group">
                              <label for="productOptions">Selectable Options (JSON):</label>
                              <textarea id="productOptions" rows="4" placeholder='[{"name":"Size","values":["A4","A5"]},{"name":"Paper","values":["Glossy","Matt"]}]'></textarea>
                              <small>Format: [{"name":"Option Name", "values":["Val1", "Val2"]}]</small>
                         </div>
                       </fieldset>

                       <fieldset id="extra-charges-outer">
                            <legend>Optional Extra Charges</legend>
                            <div class="form-group"><label for="hasExtraCharges"><input type="checkbox" id="hasExtraCharges"> Enable Additional Charge Option</label></div>
                           <div id="extra-charges-section" style="display: none;">
                               <div class="form-group"><label for="extraChargeName">Charge Name:</label><input type="text" id="extraChargeName" placeholder="e.g., Lamination"></div>
                               <div class="form-group price-group"><label for="extraChargeAmount">Charge Amount:</label><input type="number" id="extraChargeAmount" step="0.01" min="0"></div>
                           </div>
                        </fieldset>
                    </div> </div>
            </form>

             <div class="modal-actions">
                 <button type="button" id="deleteProductBtn" class="button delete-button-modal" style="display: none;">
                    <i class="fas fa-trash-alt"></i> Delete Product
                 </button>
                 <div class="modal-actions-right">
                     <button type="button" id="cancelProductBtn" class="button cancel-button">
                        Cancel
                     </button>
                     <button type="submit" form="productForm" id="saveProductBtn" class="button save-button">
                            <i class="fas fa-spinner fa-spin" style="display: none;"></i>
                            <i class="fas fa-save"></i>
                            <span>Save Product</span>
                      </button>
                </div>
              </div>
        </div>
    </div>
    <div id="deleteConfirmModal" class="modal confirmation-modal">
         <div class="modal-content small-modal">
            <span class="close-btn" id="closeDeleteConfirmModal" title="Close">&times;</span>
            <h2><i class="fas fa-exclamation-triangle warning-icon"></i> Confirm Deletion</h2>
            <p id="deleteWarningMessage">Are you sure you want to delete this product? This action cannot be undone.</p>
            <div class="confirmation-checkbox-area">
                 <input type="checkbox" id="deleteConfirmCheckbox">
                 <label for="deleteConfirmCheckbox">Yes, I understand and want to delete this product.</label>
            </div>
            <div class="modal-actions">
                 <button type="button" id="cancelDeleteFinalBtn" class="button cancel-button">
                    Cancel
                </button>
                <button type="button" id="confirmDeleteFinalBtn" class="button delete-confirm-button" disabled>
                    <i class="fas fa-trash-alt"></i> Confirm Delete
                </button>
            </div>
        </div>
    </div>
    <div id="bulkUpdateModal" class="modal">
        <div class="modal-content large-modal">
            <span class="close-btn" id="closeBulkUpdateModal" title="Close">&times;</span>
            <h2><i class="fas fa-edit info-icon"></i> Bulk Edit Products</h2>

            <form id="bulkUpdateForm">
                <div class="bulk-form-grid product-form-grid"> <div class="form-column">
                        <fieldset>
                            <legend><i class="fas fa-info-circle"></i> Basic Details</legend>
                            <div class="form-group">
                                <label for="bulkUpdateEnabledCheckbox">
                                    <input type="checkbox" id="bulkUpdateEnabledCheckbox" data-section="basic"> Update 'Show on Website (Enabled)'
                                </label>
                                <div class="bulk-fields" id="bulk-basic-fields" style="display: none;">
                                    <div class="form-group">
                                        <label for="bulkIsEnabled">Set 'Show on Website' to:</label>
                                        <select id="bulkIsEnabled">
                                            <option value="">-- Select State --</option>
                                            <option value="true">Yes (Enable)</option>
                                            <option value="false">No (Disable)</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            </fieldset>

                        <fieldset>
                            <legend><i class="fas fa-dollar-sign"></i> Price Details</legend>
                            <div class="form-group">
                                <label for="bulkUpdatePricingCheckbox">
                                    <input type="checkbox" id="bulkUpdatePricingCheckbox" data-section="pricing"> Update Pricing Details
                                </label>
                                <div class="bulk-fields" id="bulk-pricing-fields" style="display: none;">
                                    <div id="bulkPriceTabsContainer" class="price-tabs">
                                         <button type="button" class="price-tab-btn active" data-rate-type="online">Online Rate</button>
                                         <button type="button" class="price-tab-btn" data-rate-type="retail">Retail Rate</button>
                                         <button type="button" class="price-tab-btn" data-rate-type="agent">Agent Rate</button>
                                         <button type="button" class="price-tab-btn" data-rate-type="reseller">Wholesale Rate</button>
                                    </div>
                                     <div class="form-group price-group">
                                         <label for="bulkCurrentRateInput" id="bulkCurrentRateLabel">Rate for selected type:</label>
                                         <input type="number" id="bulkCurrentRateInput" placeholder="0.00" step="0.01" min="0">
                                         <small>This rate will be applied to the type selected above.</small>
                                     </div>

                                    <div class="form-group price-group">
                                        <label for="bulkPurchasePriceCheckbox">
                                             <input type="checkbox" id="bulkPurchasePriceCheckbox" data-field="pricing.purchasePrice"> Purchase Price:
                                         </label>
                                         <input type="number" id="bulkPurchasePrice" placeholder="0.00" step="0.01" min="0" disabled>
                                    </div>
                                     <div class="form-group price-group">
                                         <label for="bulkMrpCheckbox">
                                              <input type="checkbox" id="bulkMrpCheckbox" data-field="pricing.mrp"> M.R.P.:
                                          </label>
                                          <input type="number" id="bulkMrp" placeholder="0.00" step="0.01" min="0" disabled>
                                       </div>
                                       <div class="form-group">
                                           <label for="bulkGstRateCheckbox">
                                                <input type="checkbox" id="bulkGstRateCheckbox" data-field="pricing.gstRate"> GST Rate (%):
                                            </label>
                                            <input type="number" id="bulkGstRate" placeholder="e.g., 18" step="0.01" min="0" max="100" disabled>
                                        </div>
                                        <div class="form-group price-group sq-feet-only"> <label for="bulkMinOrderValueCheckbox">
                                                 <input type="checkbox" id="bulkMinOrderValueCheckbox" data-field="pricing.minimumOrderValue"> Min. Order Value (Sq Ft Only):
                                             </label>
                                             <input type="number" id="bulkMinOrderValue" placeholder="e.g., 300" step="0.01" min="0" disabled>
                                         </div>
                                </div>
                            </div>
                        </fieldset>

                        <fieldset id="bulk-wedding-fields">
                             <legend>Wedding Card Charges</legend>
                             <div class="form-group">
                                 <label for="bulkUpdateWeddingCheckbox">
                                     <input type="checkbox" id="bulkUpdateWeddingCheckbox" data-section="wedding"> Update Wedding Card Charges
                                 </label>
                                 <div class="bulk-fields" id="bulk-wedding-charge-fields" style="display: none;">
                                     <div class="form-group price-group">
                                         <label for="bulkDesignChargeCheckbox">
                                             <input type="checkbox" id="bulkDesignChargeCheckbox" data-field="pricing.designCharge"> Design Charge:
                                         </label>
                                         <input type="number" id="bulkDesignCharge" placeholder="0.00" step="0.01" min="0" disabled>
                                     </div>
                                     <div class="form-group price-group">
                                         <label for="bulkPrintingChargeCheckbox">
                                              <input type="checkbox" id="bulkPrintingChargeCheckbox" data-field="pricing.printingChargeBase"> Printing Charge (Base):
                                          </label>
                                          <input type="number" id="bulkPrintingCharge" placeholder="e.g., 700 per 100" step="0.01" min="0" disabled>
                                        </div>
                                     <div class="form-group price-group">
                                         <label for="bulkTransportChargeCheckbox">
                                              <input type="checkbox" id="bulkTransportChargeCheckbox" data-field="pricing.transportCharge"> Transport Charge:
                                          </label>
                                           <input type="number" id="bulkTransportCharge" placeholder="0.00" step="0.01" min="0" disabled>
                                        </div>
                                     <div class="form-group">
                                         <label for="bulkExtraMarginPercentCheckbox">
                                              <input type="checkbox" id="bulkExtraMarginPercentCheckbox" data-field="pricing.extraMarginPercent"> Extra Margin (%):
                                          </label>
                                          <input type="number" id="bulkExtraMarginPercent" placeholder="e.g., 10" step="0.01" min="0" disabled>
                                        </div>
                                 </div>
                             </div>
                         </fieldset>

                    </div>

                    <div class="form-column">
                        <fieldset>
                            <legend><i class="fas fa-clipboard-list"></i> Internal Details</legend>
                             <div class="form-group">
                                <label for="bulkUpdateInternalCheckbox">
                                    <input type="checkbox" id="bulkUpdateInternalCheckbox" data-section="internal"> Update Internal Details
                                </label>
                                 <div class="bulk-fields" id="bulk-internal-fields" style="display: none;">
                                     <div class="form-group">
                                         <label for="bulkBrandCheckbox">
                                             <input type="checkbox" id="bulkBrandCheckbox" data-field="brand"> Brand:
                                         </label>
                                         <input type="text" id="bulkBrand" disabled>
                                     </div>
                                     <div class="form-group">
                                          <label for="bulkItemCodeCheckbox">
                                              <input type="checkbox" id="bulkItemCodeCheckbox" data-field="itemCode"> Item Code:
                                          </label>
                                           <input type="text" id="bulkItemCode" disabled>
                                        </div>
                                     <div class="form-group">
                                         <label for="bulkHsnSacCodeCheckbox">
                                              <input type="checkbox" id="bulkHsnSacCodeCheckbox" data-field="hsnSacCode"> HSN / SAC Code:
                                          </label>
                                          <input type="text" id="bulkHsnSacCode" disabled>
                                        </div>
                                 </div>
                             </div>
                         </fieldset>

                        <fieldset>
                             <legend><i class="fas fa-cubes"></i> Stock Management</legend>
                             <div class="form-group">
                                 <label for="bulkUpdateStockCheckbox">
                                     <input type="checkbox" id="bulkUpdateStockCheckbox" data-section="stock"> Update Stock
                                 </label>
                                  <div class="bulk-fields" id="bulk-stock-fields" style="display: none;">
                                      <div class="form-group">
                                          <label for="bulkCurrentStockCheckbox">
                                              <input type="checkbox" id="bulkCurrentStockCheckbox" data-field="stock.currentStock"> Current Stock:
                                          </label>
                                          <input type="number" id="bulkCurrentStock" placeholder="0" min="0" disabled>
                                          <small>Enter the new current available quantity.</small>
                                      </div>
                                      <div class="form-group">
                                          <label for="bulkMinStockLevelCheckbox">
                                              <input type="checkbox" id="bulkMinStockLevelCheckbox" data-field="stock.minStockLevel"> Minimum Stock Level (Optional):
                                          </label>
                                          <input type="number" id="bulkMinStockLevel" placeholder="e.g., 10" min="0" disabled>
                                          <small>Optional threshold for low stock alerts.</small>
                                      </div>
                                  </div>
                              </div>
                         </fieldset>

                         <fieldset>
                           <legend><i class="fas fa-cogs"></i> Other Options</legend>
                            <div class="form-group">
                              <label for="bulkUpdateOptionsCheckbox">
                                  <input type="checkbox" id="bulkUpdateOptionsCheckbox" data-section="options"> Update Selectable Options (JSON)
                              </label>
                               <div class="bulk-fields" id="bulk-options-fields" style="display: none;">
                                   <div class="form-group">
                                       <label for="bulkOptions">Options (JSON):</label>
                                       <textarea id="bulkOptions" rows="4" placeholder='[{"name":"Size","values":["A4","A5"]},{"name":"Paper","values":["Glossy","Matt"]}]' disabled></textarea>
                                       <small>Existing options will be replaced. Format: [{"name":"Option Name", "values":["Val1", "Val2"]}]</small>
                                  </div>
                              </div>
                         </div>
                       </fieldset>

                       <fieldset id="bulk-extra-charges-outer">
                             <legend>Optional Extra Charges</legend>
                             <div class="form-group">
                                 <label for="bulkUpdateExtraChargesCheckbox">
                                     <input type="checkbox" id="bulkUpdateExtraChargesCheckbox" data-section="extraCharges"> Update Optional Extra Charges
                                 </label>
                                  <div class="bulk-fields" id="bulk-extra-charges-fields" style="display: none;">
                                      <div class="form-group">
                                          <label for="bulkHasExtraChargesCheckbox">
                                              <input type="checkbox" id="bulkHasExtraChargesCheckbox" data-field="pricing.hasExtraCharges"> Enable Additional Charge Option:
                                          </label>
                                          <select id="bulkHasExtraCharges" disabled>
                                              <option value="">-- Select State --</option>
                                              <option value="true">Yes</option>
                                              <option value="false">No</option>
                                          </select>
                                      </div>
                                     <div class="form-group price-group">
                                         <label for="bulkExtraChargeNameCheckbox">
                                             <input type="checkbox" id="bulkExtraChargeNameCheckbox" data-field="pricing.extraCharge.name"> Charge Name:
                                         </label>
                                          <input type="text" id="bulkExtraChargeName" placeholder="e.g., Lamination" disabled>
                                        </div>
                                     <div class="form-group price-group">
                                         <label for="bulkExtraChargeAmountCheckbox">
                                             <input type="checkbox" id="bulkExtraChargeAmountCheckbox" data-field="pricing.extraCharge.amount"> Charge Amount:
                                         </label>
                                          <input type="number" id="bulkExtraChargeAmount" step="0.01" min="0" disabled>
                                        </div>
                                  </div>
                              </div>
                         </fieldset>

                    </div>
                </div>
            </form>

             <div class="modal-actions">
                 <div class="modal-actions-right" style="width: 100%; justify-content: flex-end;">
                     <button type="button" id="cancelBulkUpdateBtn" class="button cancel-button">
                        Cancel
                     </button>
                     <button type="submit" form="bulkUpdateForm" id="applyBulkUpdateBtn" class="button save-button">
                            <i class="fas fa-spinner fa-spin" style="display: none;"></i>
                            <i class="fas fa-save"></i>
                            <span>Apply Updates</span>
                      </button>
                </div>
              </div>
        </div>
    </div>
    <script src="js/manage-online-products.js" type="module" defer></script>

</body>
</html>