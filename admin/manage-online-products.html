<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online Product Management</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/customer_management.css">
    <link rel="stylesheet" href="css/order_history.css">
    <link rel="stylesheet" href="css/manage-online-products.css"> <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <script type="module">
        // Firebase Core and Services
        import { initializeApp, getApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"; // Added getApp
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import {
            getFirestore, collection, doc, addDoc, updateDoc, deleteDoc,
            onSnapshot, query, orderBy, serverTimestamp, Timestamp, getDoc
        } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        import {
            getStorage, ref, uploadBytesResumable, getDownloadURL, deleteObject
        } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBQj5rQmE77kKKGYixP8y3Hcimz8tiAqzQ", // सुनिश्चित करें कि यह सही API Key है
            authDomain: "madhav-multyprint.firebaseapp.com",
            projectId: "madhav-multyprint",
            storageBucket: "madhav-multyprint.firebasestorage.app",
            messagingSenderId: "104988349637",
            appId: "1:104988349637:web:faf045b77c6786a4e70cac"
        };

        let app; // Removed auth, db, storage declaration here
        try {
            if (!window.firebaseAppInitialized) {
                app = initializeApp(firebaseConfig);
                window.firebaseAppInitialized = true;
                window.firebaseApp = app; // Expose app instance globally
                console.log("Firebase initialized (manage-online-products).");
            } else {
                app = window.firebaseApp;
                console.log("Firebase already initialized (manage-online-products).");
            }

            // Expose ONLY necessary core services globally for the main script
            window.db = getFirestore(app); // Get and expose db
            window.storage = getStorage(app); // Get and expose storage

            // Expose Firestore/Storage functions directly, NOT auth functions
            window.collection = collection;
            window.doc = doc;
            window.addDoc = addDoc;
            window.updateDoc = updateDoc;
            window.deleteDoc = deleteDoc;
            window.onSnapshot = onSnapshot;
            window.query = query;
            window.orderBy = orderBy;
            window.serverTimestamp = serverTimestamp;
            window.Timestamp = Timestamp;
            window.getDoc = getDoc;
            window.storageRef = ref;
            window.uploadBytesResumable = uploadBytesResumable;
            window.getDownloadURL = getDownloadURL;
            window.deleteObject = deleteObject;

            console.log("Firebase services made globally available (manage-online-products). Auth handled in main script.");

            // Auth state listener is now handled in manage-online-products.js

        } catch(e) {
            console.error("Firebase setup error in HTML:", e);
            alert("App Initialization Error. Check console.");
        }
    </script>
    <script src="js/manage-online-products.js" type="module" defer></script>

</body>
</html>